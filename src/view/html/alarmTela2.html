<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="icon" type="image/x-icon" href="assets/images/despertador.png">
    <link rel="stylesheet" type="text/css" href="../css/styleTela2.css" media="screen" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body id="configForm">
    <div class="container-fluid h-100 background">
        <div class="container custom-container pt-4 px-0">
            <div class="row">

                <p class="fs-1">Config</p>
            </div>
        </div>
        <div class="container custom-container px-0 text-center">
            <div class="card1 mb-3">
                <div class="row">
                    <div class="col">
                        <p class="fs-1 my-0">Time Format</p>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col">
                        <input type="radio" id="id12" name="nmTimeFormat" class="mt-3">
                        <label for="id12" class="fs-2 pe-5">12</label>

                        <input type="radio" id="id24" name="nmTimeFormat" class="mt-3" checked>
                        <label for="id24" class="fs-2">24</label>
                    </div>
                </div>
            </div>
            <div class="card1 mb-3">
                <div class="row">
                    <div class="col">
                        <p class="fs-1 my-0">Temperature</p>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col">
                        <input type="radio" id="idCelsius" name="nmTemperatureFormat" class="mt-3" checked>
                        <label for="idCelsius" class="fs-2 pe-5">ºC</label>

                        <input type="radio" id="idFahrenheit" name="nmTemperatureFormat" class="mt-3">
                        <label for="idFahrenheit" class="fs-2 pe-5">ºF</label>

                        <input type="radio" id="idKelvin" name="nmTemperatureFormat" class="mt-3">
                        <label for="idKelvin" class="fs-2">ºK</label>
                    </div>
                </div>
            </div>
            <div class="card2 mb-3">
                <div class="row">
                    <div class="col">
                        <input type="text" name="nmCity" id="idCity" placeholder="City">
                    </div>
                </div>
            </div>
            <div class="card3 mb-3">
                <div class="row">
                    <div class="col">
                        <input type="radio" id="idMr" name="nmMrOrMrs" class="mt-3" checked>
                        <label for="idMr" class="fs-2 pe-5">Mr</label>

                        <input type="radio" id="idMrs" name="nmMrOrMrs" class="mt-3">
                        <label for="idMrs" class="fs-2">Mrs</label>
                    </div>
                </div>
                <div class="row  mb-4">
                    <div class="col">
                        <input type="text" name="nmName" id="idName" placeholder="Name">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col d-flex justify-content-end">
                    <button class="button fs-2">Save</button>
                </div>
            </div>
            <div class="row">
                <div class="col d-flex justify-content-end mt-5">
                    <div class="pe-2 mt-5">
                        <a href="/">
                            <img src="../assts/time_icon_sm.png" alt="Config" width="100%">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="statusMessage"></div>
    <script>
        // Carregar as configurações ao abrir a página
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/config');
                const configuracoes = await response.json();

                if (configuracoes && configuracoes.length > 0) {
                    const config = configuracoes[0];

                    const timeFormatInput = document.querySelector(`input[name="nmTimeFormat"][value="${config.formatoHora}"]`);
                    if (timeFormatInput) timeFormatInput.checked = true;

                    const temperatureFormatInput = document.querySelector(`input[name="nmTemperatureFormat"][value="${config.escalaTemp}"]`);
                    if (temperatureFormatInput) temperatureFormatInput.checked = true;

                    const cityInput = document.getElementById('idCity');
                    if (cityInput) cityInput.value = config.cidade;

                    const mrOrMrsInput = document.querySelector(`input[name="nmMrOrMrs"][value="${config.sexo === 'M' ? 'idMr' : 'idMrs'}"]`);
                    if (mrOrMrsInput) mrOrMrsInput.checked = true;

                    const nameInput = document.getElementById('idName');
                    if (nameInput) nameInput.value = config.nome;
                }
            } catch (error) {
                console.error('Falha ao carregar configurações', error);
            }
        });

        // Enviar novas configurações ao submeter o formulário
        const form = document.getElementById('configForm');
        const statusMessage = document.getElementById('statusMessage');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            console.log("Evento de submit acionado"); 

            const formatoHora = document.querySelector('input[name="nmTimeFormat"]:checked').value;
            const escalaTemp = document.querySelector('input[name="nmTemperatureFormat"]:checked').value;
            const cidade = document.getElementById('idCity').value;
            const sexo = document.querySelector('input[name="nmMrOrMrs"]:checked').value;
            const nome = document.getElementById('idName').value;

            console.log("Valores capturados:", formatoHora, escalaTemp, cidade, sexo, nome); // Verificar os valores capturados


            // Construindo a URL com query parameters
            const url = `/config?formatoHora=${encodeURIComponent(formatoHora)}&escalaTemp=${encodeURIComponent(escalaTemp)}&cidade=${encodeURIComponent(cidade)}&sexo=${encodeURIComponent(sexo)}&nome=${encodeURIComponent(nome)}`;
 
                console.log("URL construída:", url);

                // Redirecionando para a URL
                window.location.href = url;

            try {
                const response = await fetch('/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.json();
                statusMessage.innerText = 'Configuração salva com sucesso!';

                if (result.status === 0) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Erro ao enviar configuração', error);
                statusMessage.innerText = 'Erro ao salvar configuração.';
            }
        });
    </script>
</body>

</html>